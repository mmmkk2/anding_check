<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>출근 체크 위치 확인</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 50px; }
    #status { margin-top: 20px; font-size: 1.2em; }
  </style>
</head>
<body>
  <h2>출근 체크 위치 확인 중...</h2>
  <div id="status">GPS 정보를 확인하고 있습니다.</div>

  <script>
    // sangdo
    // const targetLat = 37.5055308; 
    // const targetLng = 126.946605;
    // Anyang
    const targetLat = 37.3718374; 
    const targetLng = 126.9556982;
    const allowedRadius = 100; // meters
    const redirectURL = "https://docs.google.com/forms/d/e/1FAIpQLSfY-W7iRhIimlincrIoGQuN58MNW9dAY1XCGLwMd4xQKnsU5w/viewform";

    function getDistanceFromLatLonInMeters(lat1, lon1, lat2, lon2) {
      const R = 6371e3; // Earth's radius in meters
      const toRad = (value) => value * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function success(pos) {
      const { latitude, longitude } = pos.coords;
      const distance = getDistanceFromLatLonInMeters(latitude, longitude, targetLat, targetLng);
      if (distance <= allowedRadius) {
        document.getElementById("status").innerText = "위치 확인 완료. 출근 체크 페이지로 이동합니다...";
        setTimeout(() => window.location.href = redirectURL, 1500);
      } else {
        document.getElementById("status").innerText = `반경 100미터 이내가 아닙니다. 현재 거리: ${distance.toFixed(1)}m`;
      }
    }

    function error(err) {
      document.getElementById("status").innerText = "위치 정보를 가져올 수 없습니다. 위치 권한을 허용해주세요.";
    }

    navigator.geolocation.getCurrentPosition(success, error);
  </script>
</body>
</html>
